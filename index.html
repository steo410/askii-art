<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ASCII / 한글 아트 생성기</title>

<style>
  body {
    background: #111;
    color: #eee;
    font-family: monospace;
    padding: 20px;
  }

  #ascii {
    white-space: pre;
    font-family: monospace;
    margin-top: 20px;
    font-size: 8px;
    line-height: 8px;
  }

  canvas {
    display: none;
  }
</style>
</head>
<body>

<h2>이미지 → 문자 아트</h2>

<input type="file" id="upload" accept="image/*">

<br><br>

<label>
  글자 색상:
  <input type="color" id="color" value="#ffffff">
</label>

<label>
  해상도:
  <select id="scale">
    <option value="1">높음</option>
    <option value="2">중간</option>
    <option value="4">낮음</option>
  </select>
</label>

<label>
  문자 종류:
  <select id="charset">
    <option value="ascii">영어 ASCII</option>
    <option value="korean">한국어</option>
  </select>
</label>

<label>
  다운로드 형식:
  <select id="format">
    <option value="png">PNG</option>
    <option value="jpg">JPG</option>
  </select>
</label>

<button id="download">이미지 다운로드</button>

<div id="ascii"></div>
<canvas id="canvas"></canvas>

<script>
const upload = document.getElementById("upload");
const asciiDiv = document.getElementById("ascii");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const colorInput = document.getElementById("color");
const scaleSelect = document.getElementById("scale");
const formatSelect = document.getElementById("format");
const charsetSelect = document.getElementById("charset");

// 문자 세트
const ASCII_CHARS =
"$@B%8&WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/\\|()1{}[]?-_+~<>i!lI;:,\"^`'. ";

const KOREAN_CHARS =
"가나다라마바사아자차카타파하하하하하ㅇㅇㅇㅇㅇ···   ";

let currentImage = null;

function getChars() {
  return charsetSelect.value === "korean"
    ? KOREAN_CHARS
    : ASCII_CHARS;
}

function generateASCII() {
  if (!currentImage) return;

  const scale = parseInt(scaleSelect.value);
  const aspect = 0.5;

  canvas.width  = Math.floor(currentImage.width / scale);
  canvas.height = Math.floor(currentImage.height / scale * aspect);

  ctx.drawImage(currentImage, 0, 0, canvas.width, canvas.height);
  const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

  const chars = getChars();
  let result = "";

  for (let y = 0; y < canvas.height; y++) {
    for (let x = 0; x < canvas.width; x++) {
      const i = (y * canvas.width + x) * 4;
      const r = data[i];
      const g = data[i + 1];
      const b = data[i + 2];

      const brightness = (0.299*r + 0.587*g + 0.114*b) / 255;
      const index = Math.floor((1 - brightness) * (chars.length - 1));

      result += chars[index];
    }
    result += "\n";
  }

  asciiDiv.textContent = result;
  asciiDiv.style.color = colorInput.value;
}

upload.addEventListener("change", () => {
  const file = upload.files[0];
  if (!file) return;

  const img = new Image();
  img.onload = () => {
    currentImage = img;
    generateASCII();
  };
  img.src = URL.createObjectURL(file);
});

scaleSelect.addEventListener("change", generateASCII);
charsetSelect.addEventListener("change", generateASCII);

colorInput.addEventListener("input", () => {
  asciiDiv.style.color = colorInput.value;
});

// 다운로드
document.getElementById("download").addEventListener("click", () => {
  if (!asciiDiv.textContent.trim()) return;

  const lines = asciiDiv.textContent.split("\n");
  const fontSize = 8;
  const font = `${fontSize}px monospace`;

  const out = document.createElement("canvas");
  const octx = out.getContext("2d");
  octx.font = font;

  const width = Math.max(...lines.map(l => octx.measureText(l).width));
  out.width = Math.ceil(width);
  out.height = lines.length * fontSize;

  if (formatSelect.value === "jpg") {
    octx.fillStyle = "#fff";
    octx.fillRect(0, 0, out.width, out.height);
  }

  octx.font = font;
  octx.fillStyle = colorInput.value;
  octx.textBaseline = "top";

  lines.forEach((l, i) => {
    octx.fillText(l, 0, i * fontSize);
  });

  const mime =
    formatSelect.value === "png"
      ? "image/png"
      : "image/jpeg";

  const a = document.createElement("a");
  a.href = out.toDataURL(mime, 1.0);
  a.download = `text-art.${formatSelect.value}`;
  a.click();
});
</script>

</body>
</html>
